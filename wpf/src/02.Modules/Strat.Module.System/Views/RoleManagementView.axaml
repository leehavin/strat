<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:ursa="https://irihi.tech/ursa"
             xmlns:layout="using:Strat.Shared.Controls"
             xmlns:vm="using:Strat.Module.System.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="Strat.Module.System.Views.RoleManagementView"
             x:DataType="vm:RoleManagementViewModel"
             prism:ViewModelLocator.AutoWireViewModel="True">

    <layout:AdminPageLayout Title="角色管理" IsLoading="{Binding IsBusy}">
        <!-- 1. Search Filters -->
        <layout:AdminPageLayout.FilterContent>
            <WrapPanel Orientation="Horizontal" Margin="-12">
                <StackPanel Margin="12" Spacing="8">
                    <TextBlock Text="关键词" FontSize="12" Foreground="{DynamicResource SemiGrey6}" FontWeight="Medium"/>
                    <TextBox Width="220" Watermark="角色名称/编码" Text="{Binding SearchKeyword}" Height="32"/>
                </StackPanel>
                
                <StackPanel Margin="12" VerticalAlignment="Bottom">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Content="查询" Classes="Primary" Theme="{DynamicResource SolidButton}" 
                                Command="{Binding LoadDataCommand}" Width="80" Height="32"/>
                        <Button Content="重置" Theme="{DynamicResource OutlineButton}" Width="80" Height="32"/>
                    </StackPanel>
                </StackPanel>
            </WrapPanel>
        </layout:AdminPageLayout.FilterContent>

        <!-- 2. Action Toolbar -->
        <layout:AdminPageLayout.ActionContent>
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button Theme="{DynamicResource SolidButton}" Classes="Success" Height="32" Command="{Binding AddCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{DynamicResource SemiIconPlus}" Width="12" Height="12"/>
                        <TextBlock Text="新增角色" FontSize="13"/>
                    </StackPanel>
                </Button>
                <Button Theme="{DynamicResource OutlineButton}" Classes="Danger" Height="32">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{DynamicResource SemiIconDelete}" Width="12" Height="12"/>
                        <TextBlock Text="批量删除" FontSize="13"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </layout:AdminPageLayout.ActionContent>

        <!-- 3. Main DataGrid -->
        <layout:AdminPageLayout.MainContent>
            <DataGrid ItemsSource="{Binding Roles}" IsReadOnly="False" 
                      BorderThickness="0"
                      CanUserResizeColumns="True"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="{DynamicResource SemiBorder}">
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Width="50" Binding="{Binding IsSelected}" IsReadOnly="False"/>
                    <DataGridTextColumn Header="角色名称" Binding="{Binding Name}" Width="1.5*" MinWidth="150" IsReadOnly="True"/>
                    <DataGridTextColumn Header="角色编码" Binding="{Binding Code}" Width="1.5*" MinWidth="150" IsReadOnly="True"/>
                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="2*" MinWidth="200" IsReadOnly="True"/>
                    <DataGridTemplateColumn Header="状态" Width="100" IsReadOnly="True">
                        <DataTemplate>
                            <ursa:Badge Content="正常" Classes="Success" IsVisible="{Binding Status}" Margin="12,0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="创建时间" Binding="{Binding CreateTime}" Width="1.5*" MinWidth="160" IsReadOnly="True"/>
                    <DataGridTemplateColumn Header="操作" Width="150" IsReadOnly="True">
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="12,0">
                                <Button Theme="{DynamicResource TransparentButton}" Padding="4" ToolTip.Tip="编辑"
                                        Command="{Binding $parent[UserControl].DataContext.EditCommand}" CommandParameter="{Binding}">
                                    <PathIcon Data="{DynamicResource SemiIconEdit}" Width="14" Height="14" Foreground="{DynamicResource SemiBlue6}"/>
                                </Button>
                                <Button Theme="{DynamicResource TransparentButton}" Padding="4" ToolTip.Tip="权限设置"
                                        Command="{Binding $parent[UserControl].DataContext.PermissionCommand}" CommandParameter="{Binding}">
                                    <PathIcon Data="{DynamicResource SemiIconSetting}" Width="14" Height="14" Foreground="{DynamicResource SemiOrange6}"/>
                                </Button>
                                <Button Theme="{DynamicResource TransparentButton}" Padding="4" ToolTip.Tip="删除">
                                    <PathIcon Data="{DynamicResource SemiIconDelete}" Width="14" Height="14" Foreground="{DynamicResource SemiRed6}"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </layout:AdminPageLayout.MainContent>

        <!-- 4. Pagination -->
        <layout:AdminPageLayout.FooterContent>
            <Grid ColumnDefinitions="Auto, *, Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <TextBlock Text="共" Foreground="{DynamicResource SemiGrey6}"/>
                    <TextBlock Text="{Binding TotalCount}" FontWeight="Bold"/>
                    <TextBlock Text="条数据" Foreground="{DynamicResource SemiGrey6}"/>
                </StackPanel>
                
                <ursa:Pagination Grid.Column="2" 
                                TotalCount="{Binding TotalCount}" 
                                PageSize="{Binding PageArgs_PageSize}"
                                CurrentPage="{Binding PageArgs_PageIndex, Mode=TwoWay}" />
            </Grid>
        </layout:AdminPageLayout.FooterContent>
    </layout:AdminPageLayout>
</UserControl>