<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:ursa="https://irihi.tech/ursa"
             xmlns:layout="using:Strat.Shared.Controls"
             xmlns:vm="using:Strat.Module.System.ViewModels"
             xmlns:views="using:Strat.Module.System.Views"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="Strat.Module.System.Views.UserManagementView"
             x:DataType="vm:UserManagementViewModel"
             prism:ViewModelLocator.AutoWireViewModel="True">

    <layout:AdminPageLayout Title="用户管理" IsLoading="{Binding IsBusy}">
        <!-- 1. Search Filters -->
        <layout:AdminPageLayout.FilterContent>
            <WrapPanel Orientation="Horizontal" Margin="-12">
                <StackPanel Margin="12" Spacing="8">
                    <TextBlock Text="关键词" FontSize="12" Foreground="{DynamicResource SemiGrey6}" FontWeight="Medium"/>
                    <TextBox Width="220" Watermark="搜索账号/姓名/手机号" Text="{Binding SearchKeyword}" Height="32"/>
                </StackPanel>
                
                <StackPanel Margin="12" Spacing="8">
                    <TextBlock Text="状态" FontSize="12" Foreground="{DynamicResource SemiGrey6}" FontWeight="Medium"/>
                    <ComboBox Width="140" SelectedIndex="{Binding SearchStatusIndex}" Height="32">
                        <ComboBoxItem Content="全部"/>
                        <ComboBoxItem Content="正常"/>
                        <ComboBoxItem Content="禁用"/>
                    </ComboBox>
                </StackPanel>

                <StackPanel Margin="12" VerticalAlignment="Bottom">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Content="查询" Classes="Primary" Theme="{DynamicResource SolidButton}" 
                                Command="{Binding SearchCommand}" Width="80" Height="32"/>
                        <Button Content="重置" Theme="{DynamicResource OutlineButton}" 
                                Command="{Binding ResetCommand}" Width="80" Height="32"/>
                    </StackPanel>
                </StackPanel>
            </WrapPanel>
        </layout:AdminPageLayout.FilterContent>

        <!-- 2. Action Toolbar -->
        <layout:AdminPageLayout.ActionContent>
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button Theme="{DynamicResource SolidButton}" Classes="Success" Height="32" Command="{Binding AddCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{DynamicResource SemiIconPlus}" Width="12" Height="12"/>
                        <TextBlock Text="新增用户" FontSize="13"/>
                    </StackPanel>
                </Button>
                <Button Theme="{DynamicResource OutlineButton}" Height="32" Command="{Binding ExportCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{DynamicResource SemiIconDownload}" Width="12" Height="12"/>
                        <TextBlock Text="导出" FontSize="13"/>
                    </StackPanel>
                </Button>
                <Button Theme="{DynamicResource OutlineButton}" Classes="Danger" Height="32" Command="{Binding BatchDeleteCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <PathIcon Data="{DynamicResource SemiIconDelete}" Width="12" Height="12"/>
                        <TextBlock Text="批量删除" FontSize="13"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </layout:AdminPageLayout.ActionContent>

        <!-- 3. Main DataGrid -->
        <layout:AdminPageLayout.MainContent>
            <DataGrid ItemsSource="{Binding Users}"
                      BorderThickness="0"
                      CanUserResizeColumns="True"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="{DynamicResource SemiBorder}">
                <DataGrid.Columns>
                    <DataGridCheckBoxColumn Width="50" Binding="{Binding IsSelected}" IsReadOnly="False"/>
                    <DataGridTextColumn Header="账号" Binding="{Binding Account}" Width="1*" MinWidth="100" IsReadOnly="True" />
                    <DataGridTemplateColumn Header="用户姓名" Width="1.5*" MinWidth="150">
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center" Margin="12,0">
                                <ursa:Avatar Width="28" Height="28" Content="{Binding Name}" Theme="{DynamicResource GradientAvatar}"/>
                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" FontWeight="Medium"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="手机号" Binding="{Binding Telephone}" Width="1*" MinWidth="120" IsReadOnly="True" />
                    <DataGridTextColumn Header="邮箱" Binding="{Binding Email}" Width="1.5*" MinWidth="180" IsReadOnly="True" />
                    <DataGridTemplateColumn Header="状态" Width="100">
                        <DataTemplate>
                            <ursa:Badge Content="正常" Classes="Success" IsVisible="{Binding Status}" Margin="12,0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="创建时间" Binding="{Binding CreateTime}" Width="1.5*" MinWidth="160" IsReadOnly="True" />
                    <DataGridTemplateColumn Header="操作" Width="120">
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="8" Margin="12,0">
                                <Button Theme="{DynamicResource TransparentButton}" Padding="4" ToolTip.Tip="编辑" 
                                        Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=views:UserManagementView}}" CommandParameter="{Binding}">
                                    <PathIcon Data="{DynamicResource SemiIconEdit}" Width="14" Height="14" Foreground="{DynamicResource SemiBlue6}"/>
                                </Button>
                                <Button Theme="{DynamicResource TransparentButton}" Padding="4" ToolTip.Tip="删除"
                                        Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=views:UserManagementView}}" CommandParameter="{Binding}">
                                    <PathIcon Data="{DynamicResource SemiIconDelete}" Width="14" Height="14" Foreground="{DynamicResource SemiRed6}"/>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </layout:AdminPageLayout.MainContent>

        <!-- 4. Pagination -->
        <layout:AdminPageLayout.FooterContent>
            <Grid ColumnDefinitions="Auto, *, Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                    <TextBlock Text="共" Foreground="{DynamicResource SemiGrey6}"/>
                    <TextBlock Text="{Binding TotalCount}" FontWeight="Bold"/>
                    <TextBlock Text="条数据" Foreground="{DynamicResource SemiGrey6}"/>
                </StackPanel>
                
                <ursa:Pagination Grid.Column="2" 
                                TotalCount="{Binding TotalCount}" 
                                PageSize="{Binding PageArgs_PageSize}"
                                CurrentPage="{Binding PageArgs_PageIndex, Mode=TwoWay}" />
            </Grid>
        </layout:AdminPageLayout.FooterContent>
    </layout:AdminPageLayout>
</UserControl>