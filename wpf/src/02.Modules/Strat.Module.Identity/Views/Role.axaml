<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ursa="https://irihi.tech/ursa"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:conv="using:Strat.Shared.Converters"
             xmlns:shared="using:Strat.Shared.Controls"
             xmlns:vm="using:Strat.Module.Identity.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="Strat.Module.Identity.Views.Role"
             x:DataType="vm:RoleViewModel"
             prism:ViewModelLocator.AutoWireViewModel="True">

    <UserControl.Resources>
        <conv:StatusConverter x:Key="StatusConverter"/>
        <conv:StatusToBackgroundConverter x:Key="StatusToBackgroundConverter"/>
        <conv:StatusToForegroundConverter x:Key="StatusToForegroundConverter"/>
    </UserControl.Resources>

    <shared:AdminPageLayout Title="角色管理">
        <!-- Filter Bar -->
        <shared:AdminPageLayout.FilterContent>
            <StackPanel Orientation="Horizontal" Spacing="{DynamicResource Spacing_M}">
                <TextBox Width="150" 
                          Text="{Binding SearchModel.Name}" 
                          Watermark="请输入角色名称"
                          Height="{DynamicResource Height_Input_M}"
                          FontSize="{DynamicResource FontSize_Base}"/>
                <TextBox Width="150" 
                          Text="{Binding SearchModel.Code}" 
                          Watermark="请输入角色编码"
                          Height="{DynamicResource Height_Input_M}"
                          FontSize="{DynamicResource FontSize_Base}"/>
                <Button Content="查询" 
                        Command="{Binding SearchCommand}" 
                        Theme="{DynamicResource PrimaryButton}"
                        Height="{DynamicResource Height_Button_M}"/>
                <Button Content="重置" 
                        Command="{Binding ResetCommand}"
                        Theme="{DynamicResource DefaultButton}"
                        Height="{DynamicResource Height_Button_M}"/>
            </StackPanel>
        </shared:AdminPageLayout.FilterContent>

        <!-- Action Toolbar -->
        <shared:AdminPageLayout.ActionContent>
            <StackPanel Orientation="Horizontal" Spacing="{DynamicResource Spacing_S}">
                <Button Content="+ 新增角色" 
                        Command="{Binding AddCommand}"
                        Theme="{DynamicResource PrimaryButton}"
                        Height="{DynamicResource Height_Button_M}"/>
                <Button Content="批量删除" 
                        Command="{Binding BatchDeleteCommand}"
                        Theme="{DynamicResource DangerButton}"
                        Height="{DynamicResource Height_Button_M}"/>
                <Button Content="刷新" 
                        Command="{Binding SearchCommand}"
                        Theme="{DynamicResource DefaultButton}"
                        Height="{DynamicResource Height_Button_M}"/>
            </StackPanel>
        </shared:AdminPageLayout.ActionContent>

        <!-- Main DataGrid -->
        <shared:AdminPageLayout.MainContent>
            <DataGrid ItemsSource="{Binding RolePaginationModel.Items}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserSortColumns="True"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      SelectionMode="Extended"
                      RowHeight="{DynamicResource Height_TableRow_Normal}">
                
                <DataGrid.Columns>
                    <!-- Selection Column -->
                    <DataGridTemplateColumn Width="50">
                        <DataGridTemplateColumn.Header>
                            <CheckBox IsChecked="{Binding $parent[UserControl].DataContext.IsAllSelected}" HorizontalAlignment="Center"/>
                        </DataGridTemplateColumn.Header>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsSelected}" HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Role Name -->
                    <DataGridTextColumn Header="角色名称" Binding="{Binding Name}" Width="150"/>
                    
                    <!-- Role Code -->
                    <DataGridTextColumn Header="角色编码" Binding="{Binding Code}" Width="120"/>
                    
                    <!-- Description -->
                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="*"/>
                    
                    <!-- Status -->
                    <DataGridTemplateColumn Header="状态" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="{Binding Status, Converter={StaticResource StatusToBackgroundConverter}}"
                                        CornerRadius="{DynamicResource Radius_S}"
                                        Padding="{DynamicResource Spacing_XS},2"
                                        HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Status, Converter={StaticResource StatusConverter}}"
                                               Foreground="{Binding Status, Converter={StaticResource StatusToForegroundConverter}}"
                                               FontSize="{DynamicResource FontSize_Small}"
                                               FontWeight="{DynamicResource FontWeight_Medium}"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <!-- Create Time -->
                    <DataGridTextColumn Header="创建时间" Binding="{Binding CreateTime, StringFormat='yyyy-MM-dd HH:mm'}" Width="150"/>
                    
                    <!-- Operations -->
                    <DataGridTemplateColumn Header="操作" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                    <Button Content="编辑" 
                                            Theme="{DynamicResource BorderlessButton}"
                                            Foreground="{DynamicResource SemiBlue6}"
                                            Command="{Binding $parent[UserControl].DataContext.EditCommand}"
                                            CommandParameter="{Binding}"/>
                                    <Button Content="删除" 
                                            Theme="{DynamicResource BorderlessButton}"
                                            Foreground="{DynamicResource SemiRed6}"
                                            Command="{Binding $parent[UserControl].DataContext.DeleteCommand}"
                                            CommandParameter="{Binding}"/>
                                    <Button Content="{Binding Status, Converter={StaticResource StatusConverter}, ConverterParameter='ToggleText'}" 
                                            Theme="{DynamicResource BorderlessButton}"
                                            Foreground="{Binding Status, Converter={StaticResource StatusToForegroundConverter}}"
                                            Command="{Binding $parent[UserControl].DataContext.ToggleStatusCommand}"
                                            CommandParameter="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </shared:AdminPageLayout.MainContent>

        <!-- Footer / Pagination -->
        <shared:AdminPageLayout.FooterContent>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="{DynamicResource Spacing_S}">
                <TextBlock VerticalAlignment="Center" 
                           Foreground="{DynamicResource SemiGrey5}"
                           FontSize="{DynamicResource FontSize_Small}">
                    <Run Text="共 "/>
                    <Run Text="{Binding RolePaginationModel.Total}" FontWeight="{DynamicResource FontWeight_SemiBold}"/>
                    <Run Text=" 条记录"/>
                </TextBlock>
            </StackPanel>
        </shared:AdminPageLayout.FooterContent>
    </shared:AdminPageLayout>
</UserControl>

