<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:semi="https://irihi.tech/semi"
             xmlns:ursa="https://irihi.tech/ursa"
             xmlns:vm="using:Strat.Module.Identity.ViewModels"
             xmlns:converters="using:Strat.Module.Identity.Converters"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="Strat.Module.Identity.Views.Login"
             x:DataType="vm:LoginViewModel">

    <UserControl.Resources>
        <converters:EyeIconConverter x:Key="EyeIconConverter"/>
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- 企业级按钮点击动画 -->
        <Style Selector="Button.EnterpriseLogin:pointerover">
            <Setter Property="RenderTransform" Value="scale(1.02)"/>
        </Style>
        <Style Selector="Button.EnterpriseLogin:pressed">
            <Setter Property="RenderTransform" Value="scale(0.98)"/>
        </Style>
        
        <!-- 输入框聚焦动画 -->
        <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SemiBlue6}"/>
        </Style>
    </UserControl.Styles>

    <Grid Background="{DynamicResource SemiBackground0}">
        <!-- Dynamic Mesh Background (Subtle) -->
        <Canvas IsHitTestVisible="False" Opacity="0.4">
            <Ellipse Width="600" Height="600" Canvas.Left="-200" Canvas.Top="-200" Opacity="0.1">
                <Ellipse.Fill>
                    <RadialGradientBrush Center="50%,50%" GradientOrigin="50%,50%" RadiusX="50%" RadiusY="50%">
                        <GradientStop Color="{DynamicResource SemiColorBlue6}" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.Fill>
            </Ellipse>
            <Ellipse Width="500" Height="500" Canvas.Right="-100" Canvas.Bottom="-100" Opacity="0.1">
                <Ellipse.Fill>
                    <RadialGradientBrush Center="50%,50%" GradientOrigin="50%,50%" RadiusX="50%" RadiusY="50%">
                        <GradientStop Color="{DynamicResource SemiColorIndigo6}" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.Fill>
            </Ellipse>
        </Canvas>

        <Grid ColumnDefinitions="*, 560">
            <!-- Left Side: Brand Flagship Area -->
            <Grid Grid.Column="0" ClipToBounds="True">
                <Grid.Background>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="#0F172A" Offset="0"/>
                        <GradientStop Color="#1E293B" Offset="1"/>
                    </LinearGradientBrush>
                </Grid.Background>

                <!-- Mesh Grid Overlay -->
                <Panel IsHitTestVisible="False" Opacity="0.12">
                    <Panel.Background>
                        <VisualBrush TileMode="Tile" SourceRect="0,0,40,40" DestinationRect="0,0,40,40">
                            <VisualBrush.Visual>
                                <Path Data="M 40 0 L 0 0 0 40" Stroke="White" StrokeThickness="0.5"/>
                            </VisualBrush.Visual>
                        </VisualBrush>
                    </Panel.Background>
                </Panel>

                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="40">
                    <!-- Premium Logo Instance -->
                    <Border Width="110" Height="110" CornerRadius="28" Padding="20"
                            Background="White" BoxShadow="0 20 40 0 #40000000">
                        <Viewbox>
                            <Path Data="{DynamicResource SemiIconLogo}" Fill="{DynamicResource SemiBlue6}"/>
                        </Viewbox>
                    </Border>
                    
                    <StackPanel Spacing="16" HorizontalAlignment="Center">
                        <TextBlock Text="Strat Admin" FontSize="{DynamicResource FontSize_Display}" FontWeight="Black" Foreground="White" LetterSpacing="2"/>
                        <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center" Opacity="0.7">
                            <Border Padding="8,2" CornerRadius="4" Background="{DynamicResource SemiBlue6}">
                                <TextBlock Text="PRO" FontSize="{DynamicResource FontSize_Caption}" FontWeight="Bold" Foreground="White"/>
                            </Border>
                            <TextBlock Text="Enterprise Console" FontSize="{DynamicResource FontSize_H3}" Foreground="White" FontWeight="Light"/>
                        </StackPanel>
                    </StackPanel>

                    <Rectangle Width="60" Height="4" RadiusX="2" RadiusY="2" Fill="{DynamicResource SemiBlue6}" Margin="0,10"/>
                    
                    <TextBlock Text="The Future of Enterprise Management" 
                               FontSize="16" Foreground="White" Opacity="0.6" FontWeight="Light"
                               HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Footer Copyright (Left) -->
                <StackPanel Orientation="Horizontal" Spacing="20" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,40" Opacity="0.4">
                    <TextBlock Text="© 2026 Strat Ecosystem" FontSize="12" Foreground="White"/>
                    <Separator Width="1" Height="10" Background="White"/>
                    <TextBlock Text="Privacy Policy" FontSize="12" Foreground="White"/>
                </StackPanel>
            </Grid>

            <!-- Right Side: Interaction Area -->
            <Border Grid.Column="1" Background="{DynamicResource SemiBackground0}" Padding="80,0">
                <Grid RowDefinitions="Auto, *, Auto">
                    
                    <!-- Top Actions: Theme & Language -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,32" Spacing="16">
                        <!-- Theme Toggle -->
                        <Button Command="{Binding SwitchThemeCommand}" 
                                Theme="{DynamicResource TransparentButton}" 
                                Width="40" Height="40" CornerRadius="20" Padding="0">
                            <PathIcon Data="{Binding CurrentTheme, Converter={StaticResource ThemeToIconConverter}}" 
                                      Width="18" Height="18"/>
                        </Button>
                        
                        <!-- Language Selector -->
                        <ComboBox ItemsSource="{Binding SupportedLanguages}" 
                                  SelectedItem="{Binding CurrentLanguage}"
                                  Theme="{DynamicResource BorderlessComboBox}"
                                  Width="120">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="{Binding Name}" FontSize="13"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <!-- Login Form Core -->
                    <StackPanel Grid.Row="1" VerticalAlignment="Center" Spacing="48" Margin="0,-20,0,0">
                        <StackPanel Spacing="12">
                            <TextBlock Text="Welcome Back" FontSize="{DynamicResource FontSize_H1}" FontWeight="ExtraBold" LetterSpacing="-0.5"/>
                            <TextBlock Text="Enter your credentials to access the platform" 
                                       FontSize="{DynamicResource FontSize_Large}" Foreground="{DynamicResource SemiGrey6}" FontWeight="Normal"/>
                        </StackPanel>

                        <ursa:Form LabelPosition="Top">
                            <!-- Account -->
                            <ursa:FormItem Label="Username or Email" Margin="0,0,0,24">
                                <TextBox Text="{Binding LoginUser.Account}" 
                                         Watermark="e.g. admin@strat.com" 
                                         Height="{DynamicResource Height_Input_L}" Classes="Large" CornerRadius="{DynamicResource Radius_M}"
                                         IsReadOnly="{Binding IsBusy}">
                                    <TextBox.InnerLeftContent>
                                        <PathIcon Data="{DynamicResource SemiIconUser}" Width="18" Height="18" 
                                                  Foreground="{DynamicResource SemiGrey6}" Margin="16,0,8,0"/>
                                    </TextBox.InnerLeftContent>
                                </TextBox>
                            </ursa:FormItem>
                            
                            <!-- Password -->
                            <ursa:FormItem Label="Security Password">
                                <TextBox Text="{Binding LoginUser.Password}" 
                                         Watermark="••••••••" 
                                         PasswordChar="●" 
                                         RevealPassword="{Binding ShowPassword}"
                                         Height="{DynamicResource Height_Input_L}" Classes="Large" CornerRadius="{DynamicResource Radius_M}"
                                         IsReadOnly="{Binding IsBusy}">
                                    <TextBox.InnerLeftContent>
                                        <PathIcon Data="{DynamicResource SemiIconLock}" Width="18" Height="18" 
                                                  Foreground="{DynamicResource SemiGrey6}" Margin="16,0,8,0"/>
                                    </TextBox.InnerLeftContent>
                                    <TextBox.InnerRightContent>
                                        <Button Theme="{DynamicResource TransparentButton}"
                                                Command="{Binding TogglePasswordVisibilityCommand}"
                                                Padding="12" Width="48" Height="52">
                                            <PathIcon Data="{Binding ShowPassword, Converter={StaticResource EyeIconConverter}}" 
                                                      Width="18" Height="18" Foreground="{DynamicResource SemiGrey6}"/>
                                        </Button>
                                    </TextBox.InnerRightContent>
                                </TextBox>
                            </ursa:FormItem>
                        </ursa:Form>

                        <Grid ColumnDefinitions="*, Auto" Margin="4,0">
                            <CheckBox Content="Keep me signed in" FontSize="{DynamicResource FontSize_Small}" VerticalAlignment="Center"/>
                            <Button Grid.Column="1" Content="Forgot password?" Classes="Link" FontSize="{DynamicResource FontSize_Small}" Padding="0"/>
                        </Grid>

                        <Button Command="{Binding LoginCommand}" 
                                Height="{DynamicResource Height_Button_L}" HorizontalAlignment="Stretch"
                                Classes="Primary Large EnterpriseLogin" 
                                Theme="{DynamicResource SolidButton}"
                                CornerRadius="{DynamicResource Radius_L}" FontSize="{DynamicResource FontSize_Button_Large}" FontWeight="Bold">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="Sign In to Strat"/>
                                <PathIcon Data="{DynamicResource SemiIconArrowRight}" Width="18" Height="18" IsVisible="{Binding !IsBusy}"/>
                            </StackPanel>
                        </Button>

                        <!-- Social Connection -->
                        <StackPanel Spacing="24">
                            <Grid ColumnDefinitions="*, Auto, *">
                                <Rectangle Grid.Column="0" Height="1" Fill="{DynamicResource SemiGrey3}" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="OR CONTINUE WITH" Margin="16,0" FontSize="12" FontWeight="Bold" Foreground="{DynamicResource SemiGrey5}" LetterSpacing="1"/>
                                <Rectangle Grid.Column="2" Height="1" Fill="{DynamicResource SemiGrey3}" VerticalAlignment="Center"/>
                            </Grid>
                            
                            <Grid ColumnDefinitions="*, *">
                                <Button Grid.Column="0" Margin="0,0,8,0" Theme="{DynamicResource OutlineButton}" Height="48" CornerRadius="10">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <PathIcon Data="{DynamicResource SemiIconGithub}" Width="18" Height="18"/>
                                        <TextBlock Text="GitHub" FontSize="14" FontWeight="Medium"/>
                                    </StackPanel>
                                </Button>
                                <Button Grid.Column="1" Margin="8,0,0,0" Theme="{DynamicResource OutlineButton}" Height="48" CornerRadius="10">
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <PathIcon Data="{DynamicResource SemiIconCheckCircle}" Width="18" Height="18" Foreground="{DynamicResource SemiGreen6}"/>
                                        <TextBlock Text="Google" FontSize="14" FontWeight="Medium"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </StackPanel>
                    </StackPanel>

                    <!-- Bottom Help -->
                    <StackPanel Grid.Row="2" Margin="0,0,0,40" VerticalAlignment="Bottom">
                        <TextBlock HorizontalAlignment="Center" FontSize="14" Foreground="{DynamicResource SemiGrey6}">
                            Don't have an account? <Span Foreground="{DynamicResource SemiBlue6}" FontWeight="SemiBold">Contact Administration</Span>
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Premium Loading Mask -->
        <Panel IsVisible="{Binding IsBusy}" ZIndex="1000">
            <Panel Background="{DynamicResource SemiBackground0}" Opacity="0.8"/>
            <Border Background="{DynamicResource SemiBackground0}" CornerRadius="20" Padding="40"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    BoxShadow="0 10 30 0 #20000000">
                <StackPanel Spacing="24">
                    <ursa:Loading IsLoading="True" Classes="Large" Width="48" Height="48"/>
                    <TextBlock Text="Authenticating Identity..." FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Panel>
    </Grid>
</UserControl>
